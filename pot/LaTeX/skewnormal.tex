\documentclass[11pt]{article}
\usepackage{amssymb, amsthm, amsmath}
\usepackage{bm}
\usepackage{graphicx}
\usepackage[authoryear]{natbib}
\usepackage{bm}
\usepackage{verbatim}
\usepackage{lineno}
\usepackage{times}
\usepackage{soul}
\usepackage{color}

\usepackage[left=1in,top=1in,right=1in]{geometry}
\pdfpageheight 11in
\pdfpagewidth 8.5in
\linespread{1.0}
\input{mycommands.sty}


\begin{document}\linenumbers

\begin{center}
{\Large {\bf A new spatial model for points above a threshold}}\\
\today
\end{center}

\section{Introduction}\label{s:intro}
In most climatological applications, researchers are interested in learning about the average behavior of different climate variables (e.g. ozone, temperature, rainfall).
However, averages do not help regulators prepare for the unusual events that only happen once every 100 years.
For example, it is important to have an idea of how much rain will come in a 100-year floor in order to construct strong enough river levees to protect lands from flooding.

The extremal coefficient describes the pairwise dependence between spatial locations \citep{Smith1990}.
Consider a spatial process $Y(\bs) \in \calR^n$ observed at locations $s \in \calD \subset \calR^2$.
Then the bivariate extremal coefficient, $\theta(\bs_i, \bs_j) \in [1, 2]$, is defined as
\begin{align}
  \Pr(Y(\bs_i) < c, Y(\bs_j) < c) = \Pr(Y(\bs_i) < c)^{\theta(\bs_i, \bs_j) }. \label{eq:extremalcoef}
\end{align}
One way to characterize the dependence over the entire set of spatial locations is to calculate all of the pairwise extremal coefficients.
Although this method provides information regarding the spatial structure of the observations, it does not fully characterize the joint spatial dependence.

Alternatively, one can use the $\chi$ coefficient as a measure of extremal dependence.
The $\chi$ coefficient for the upper tail is given by
\begin{align*}
	\chi = \lim_{c \rightarrow \infty} \Pr(Y(\bs_1) > c | Y(\bs_2) > c)
\end{align*}
In a stationary spatial process, we can write the $\chi$ coefficient as
\begin{align*}
	\chi(\bh) = \lim_{c \rightarrow \infty} \Pr(Y(0) > c | Y(\bh) > c)
\end{align*}
where $\bh = ||\bs_1 - \bs_2||$.
If $\chi(\bh) = 0$, then observations are asymptotically independent at distance $\bh$.
For Gaussian processes, $\chi(\bh) = 0$ regardless of the the distance, so they are not suitable for modeling spatially dependent extremes.

Unlike multivariate normal distributions, it is challenging to model multivariate extreme value distributions (e.g. generalized extreme value and generalized Pareto distribution) because few closed-form expressions exist for the density in more than two-dimensions \citep{Coles1991}.
Given this limitation, pairwise composite likelihoods have been used when modeling dependent extremes \citep{Padoan2010,Blanchet2011,Huser2013}.
One way around the multi-dimensional limitation of multivariate extreme value distributions is to use skew elliptical distributions to model dependent extreme values \citep{Genton2004,Zhang2010,Padoan2011}.
Due to their flexibility, the skew-normal and skew-$t$ distribution offer a flexible way to handle non-symmetric data within a framework of multivariate normal and multivariate t-distributions.
As with the spatial Gaussian process, the skew-normal distribution is also asymptotically independent; however, the skew-$t$ does demonstrate asymptotic dependence \citep{Padoan2011}.

In this paper, we present a model that has marginal distributions with flexible tails, demonstrates asymptotic dependence for $\bh$ small, and has computation on the order of Gaussian models for large space-time datasets.
Specifically, we use a multivariate skew-$t$ distribution that incorporates thresholding and random spatial partitions.
The advantage of using a thresholded model as opposed to a non-thresholded model is that is allows for the tails of the distribution to inform the predictions in the tails \citep{DuMouchel1983}.
The random spatial partitions increase the flexibility of the model by giving us a way to account for observations in spatial regions that may have higher variability due to certain regional climate variables (e.g. forest fires).

\section{Statistical model}\label{s:model}

Let $Y_t(\bs)\in \calR$ be the observed value at location $\bs$ on day $t$.
To avoid bias in estimating tail parameters, we model thresholded data
\beq\label{Yt}
  \Yt_t(\bs) = \left\{
          \begin{array}{ll}
            Y_t(\bs) & Y_t(\bs)>T \\
            T & Y_t(\bs)\le T
          \end{array}
        \right.
\eeq
where $T$ is a pre-specified threshold.
Then, assuming the full data follow a skew-$t$ distribution, we update values below the threshold using standard Bayesian missing data methods as described in Section \ref{s:comp}.

\subsection{Complete data}\label{s:data}
We assume the data can be modeled as skew-$t$ \citep{Zhang2010}
\begin{align} \label{eq:fullmodel}
  Y_t(\bs) &= X_t(\bs) \beta + \alpha z_t + \sigma_t v_t(\bs)
\end{align}
where $\alpha \in \calR$ controls the skewness, $z_{t} \ind N_{(0, \infty)}(0, \sigma^2_t)$ are a random effect from a half-normal distribution (see appendix A.3), $v_t(\bs)$ is a Gaussian process with mean zero, variance one, and \Matern correlation, and $\sigma^2_t \iid \text{IG}(a, b)$.
When marginalizing over the $z_t$ and $\sigma^2_t$ terms,
\begin{align*}
  Y_t(\bs) \sim \text{skew-}t (\mu, \Sigma^*, \alpha, \text{df} = 2a)
\end{align*}
where $\mu$ is the location, $\Sigma^* = \frac{ b }{ a } \Sigma$, $\Sigma$ is a \Matern covariance matrix, $a, b$ are the parameters from the inverse gamma distribution for $\sigma^2_t$, and $\alpha \in \calR$ controls the skewness.
The skew-$t$ process is desirable because it has a flexible tail that is controlled by both the skewness parameter $\alpha$ and the degrees of freedom.
This process also has the desirable characteristic that $\chi(\bh) > 0$ \citep{Padoan2011}.

\subsection{Random daily partition}\label{s:part}
One problem with the skew-$t$ distribution is that $\chi(\bh)$ does not suggest asymptotic independence as the distance increases.
This occurs because all observations, both near and far, share the same $z_t$ and $\sigma^2_t$ terms.
We handle this problem with a daily random partition similar to \citet{Huser2014} that allows $z_t$ and $\sigma^2_t$ to vary by site.
The model then becomes
\begin{align}
  Y_t(\bs) &= X_t(\bs) \beta + \alpha z_t(\bs) + \sigma_t(\bs) v_t(\bs)
\end{align}
where $\alpha$ controls the skewness, $z_t(\bs) \ind \text{N}_{(0, \infty)}(0, \sigma^2_t(\bs))$, $v_t(\bs)$ is defined as before, and $\sigma^2_t(\bs) \iid \text{IG}(a, b)$.
Consider a set of daily knots $\bw_{tk} \sim \text{Uniform}$ that define a random daily partition $P_{t1}, \ldots, P_{tK}$ such that
\begin{align*}
  P_{tk} = \{ \bs : k = \argmin_\ell || \bs - \bw_{t\ell} \}.
\end{align*}
So, for $\bs \in P_{tk}$, let
\begin{align}
  z_t(\bs) &= z_{tk} \label{eq:sitez}\\
  \sigma^2_t(\bs) &= \sigma^2_{tk} \label{eq:sitesig}.
\end{align}
Then within each partition, $Y_t(\bs)$ follows the distribution given in (\ref{eq:fullmodel}).

\subsection{Hierarchical model}\label{s:hier}
Conditioned on $z_t(\bs)$ and $\sigma^2_t(\bs)$, $Y_t(\bs)$ is a Gaussian spatial model.
Thus, standard geostatistical methods can be used to fit the model, and predictions can be made by Kriging at unobserved locations.
We model this with a Bayesian hierarchical model as follows.
Let $w_{t1}, \ldots, w_{tK}$ be partition centers so that
\begin{align*}
 P_{tk} = \{\bs : k = \argmin_\ell || \bs_t - w_{t\ell} ||\}.
\end{align*}
Then
\begin{align}
   Y_t(\bs) \mid \Theta, z_{t}(\bs) &= X_t(\bs) \beta + \alpha z_t(\bs) + \sigma
   _t(\bs) v_t(\bs) \label{eq:hier}\\
   z_{tk} \mid \sigma^2_{tk} &\sim N_{(0, \infty)}(0, \sigma^2_{tk})\\
   \sigma^2_{tk} &\iid IG(\alpha, \beta)\\
   v_t(\bs) \mid \Theta &\sim \Matern(0, \Sigma)\\
   \alpha &\sim N(0, 10)\\
   w_{tk} &\sim Unif(\calR^2)
\end{align}
where $\Theta = \{w_{t1}, \ldots, w_{tK}, \beta, \sigma_t, \alpha, \lambda, \rho, \nu \}$; $z_t(\bs)$ and $\sigma^2_t(\bs)$ are defined as in (\ref{eq:sitez}) and (\ref{eq:sitesig}); \mbox{$k = \argmin_\ell ||\bs - \bw_\ell ||$}; and $\Sigma$ is a \Matern covariance matrix with variance one, spatial range $\rho$, smoothness $\nu$.

\section{Computation}\label{s:comp}
The MCMC for this model is fairly straightforward.
First, we impute values below the threshold.
Then, we update $\Theta$ using random walk MH or Gibbs sampling when appropriate.
Finally, we make spatial precictions using conditional multivariate normal results and the fact that the distribution of $Y_t(\bs) \mid \Theta, z_{tl}$ is the usual multivariate normal distribution with a \Matern spatial covariance structure.

\subsection{Imputation}\label{s:impute}
We can use Gibbs sampling to update $Y_t(\bs)$ for observations that are below $T$, the thresholded value. Given $\Theta$, $Y_t(\bs)$ has truncated normal full conditional with these parameter values.
So we sample $Y_t(\bs) \sim N_{(-\infty, T)}(\mu(\bs), \Sigma)$

\subsection{Parameter updates}\label{s:params}
To update $\Theta$ given the current value of the complete data $\bY_1, \ldots, \bY_T$, we use a standard Gibbs updates for all parameters except for the knot locations which are done using a Metropolis update.
See Appendix A.1 for details regarding Gibbs sampling.

\subsection{Spatial prediction}\label{s:pred}
Given $\bY_t$ the usual Kriging equations give the predictive distribution for $Y_t(\bs^*)$ at prediction location $(\bs^*)$

\section{Data analysis}\label{s:analysis}

\section{Conclusions}\label{s:con}

\section*{Acknowledgments}

\section*{Appendix A.1: Posterior distributions}
\input{zpost.tex}
\input{betapost.tex}
\input{sigpost.tex}
\input{alphapost.tex}

\section*{Appendix A.2: MCMC details}


\section*{Appendix A.3: Half-normal distribution}
Let $u = |z|$ where $Z \sim N(\mu, \sigma^2)$.
Specifically, we consider the case where $\mu = 0$. Then $U$ follows a half-normal distribution which we denote as $U \sim HN(0, 1)$, and the density is given by
\begin{align}
  f_U(u) = \frac{ \sqrt{2} }{ \sqrt{\pi \sigma^2} } \exp \left( - \frac{ u^2 }{ 2 \sigma^2 } \right) I(u > 0)
\end{align}
When $\mu = 0$, the half-normal distribution is also equivalent to a $N_{(0, \infty)}(0, \sigma^2)$ where $N_{(a, b)}(\mu, \sigma^2)$ represents a normal distribution with mean $\mu$ and standard deviation $\sigma$ that has been truncated below at $a$ and above at $b$.

\bibliographystyle{rss}
\bibliography{skewnormal}

\end{document}


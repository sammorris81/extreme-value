\documentclass[11pt]{article}
\usepackage{amssymb, amsthm, amsmath}
\usepackage{bm}
\usepackage{graphicx}
\usepackage[authoryear]{natbib}
\usepackage{bm}
\usepackage{verbatim}
\usepackage{lineno}
\usepackage{times}
\usepackage{soul}
\usepackage{color}

\usepackage[left=1in,top=1in,right=1in]{geometry}
\pdfpageheight 11in
\pdfpagewidth 8.5in
\linespread{1.0}
\input{mycommands.sty}


\begin{document}\linenumbers

\begin{center}
{\Large {\bf A new spatial model for points above a threshold}}\\
\today
\end{center}

\section{Introduction}\label{s:intro}

\section{Statistical model}\label{s:model}

Let $Y_t(\bs)\in \calR$ be the observed value at location $\bs$ on day $t$.  To avoid bias in estimating tail parameters, we model the thresholded data
\beq\label{Yt}
  \Yt_t(\bs) = \left\{
          \begin{array}{ll}
            Y_t(\bs) & Y_t(\bs)>T \\
            T & Y_t(\bs)\le T
          \end{array}
        \right.
\eeq
where $T$ is a pre-specified threshold.   

We first specify a model for the complete data, $Y_t(\bs)$, and then study the induced model for thresholded data, $\Yt_t(\bs)$.  
The full data model is given in Section \ref{s:model} assuming a skew normal distribution with a different variance each day.
Computationally, the values below the threshold are updated using standard Bayesian missing data methods as described in Section \ref{s:comp}.
The skew normal representation is from \citep{Minozzo2012} and is the sum of a normal and half-normal random variable.
\subsection{Half-normal distribution}\label{s:hn}
Let $u = |z|$ where $Z \sim N(\mu, \sigma^2)$.
Specifically, we consider the case where $\mu = 0$. Then $U$ follows a half-normal distribution which we denote as $U \sim HN(0, 1)$, and the density is given by 
\begin{align}
  f_U(u) = \frac{ \sqrt{2} }{ \sqrt{\pi \sigma^2} } \exp \left( - \frac{ u^2 }{ 2 \sigma^2 } \right) I(u > 0)
\end{align}
When $\mu = 0$, the half-normal distribution is also equivalent to a $N_{(0, \infty)}(0, \sigma^2)$ where $N_{(a, b)}(\mu, \sigma^2)$ represents a normal distribution with mean $\mu$ and standard deviation $\sigma$ that has been truncated below at $a$ and above at $b$.

\subsection{Complete data}\label{s:model}
Consider the spatial process
\begin{align} \label{eq:fullmodel}
  Y_t(\bs) &= X_t(\bs) \beta + e_t(\bs)\\
  e_t(\bs) &= \delta z_t(\bs) + v_t(\bs)
\end{align}
where $z_t(\bs) = z_{tl}$ if $s \in P_{tl}$ where $P_{t1}, \ldots, P_{tL}$ form a partition, and $z_{tl} \iid N_{(0, \infty)}(0, \sigma_t^2)$, $\delta \in (-1, 1)$ controls skew, and $v_t(\bs)$ is a spatial Gaussian process with mean zero and variance $\sigma_t^2(1 - \delta^2)$.

Then $Y_t(\bs)$ is skew normal within each partition \citep{Minozzo2012}.
We model this with a Bayesian hierarchical model as follows.
Let $w_{t1}, \ldots, w_{tL}$ be partition centers so that
\begin{align*}
  P_{tl} = \{\bs_t : l = \argmin_k || \bs_t - w_{tk} ||\}.
\end{align*}
Then
\begin{align}
    Y_t(\bs) \mid \Theta, z_{t1}, \ldots, z_{tL} &= X_t(\bs) \beta + \delta z_t(\bs) + v_t(\bs) \label{eq:hier}\\
    z_{tl}(\bs) \mid \Theta &\sim N_{(0, \infty)}(0, \sigma^2_t)\\
    v_t(\bs) \mid \Theta &\sim \Matern(0, \Sigma)\\
    \sigma &\sim IG(\alpha, \beta)\\
    \delta &\sim Unif(-1, 1)\\
    w_{tk} &\sim Unif(\calD)
\end{align}
where $\Theta = \{w_{t1}, \ldots, w_{tL}, \beta, \sigma_t, \delta, \rho, \nu \}$; $l = \argmin_k ||\bs - w_k ||$; $\Sigma_t$ is a \Matern covariance matrix with variance $\sigma_t^2 (1 - \delta^2)$, spatial range $\rho$ and smoothness $\nu$; and $\calD$ is the spatial domain of interest.

\section{Computation}\label{s:comp}
The MCMC for this model is fairly straightforward.
First, we impute values below the threshold.
Then, we update $\Theta$ using random walk MH or Gibbs sampling when appropriate.
Finally, we make spatial predictions.
Each requires the joint distribution for the complete data given $\Theta$.
As defined in \ref{eq:hier}, the distribution of $Y_t(\bs) \mid \Theta$ is the usual multivariate normal distribution with a \Matern spatial covariance structure.

\subsection{Imputation}\label{s:impute}
We can use Gibbs sampling to update $\Yt_t(\bs)$ for observations that are below $T$, the thresholded value. Given $\Theta$, $Y_t(\bs)$ has truncated normal full conditional with these parameter values.
So we sample $Y_t(\bs) \sim N_{(-\infty, T)}$

\subsection{Parameter updates}\label{s:params}
To update $\Theta$ given the current value of the complete data $\bY_1, \ldots, \bY_T$, we use a standard Gibbs updates for all parameters except for the knot locations which are done using a Metropolis update.
See Appendix A.1 for details regarding Gibbs sampling and $|u_t(\bs)|$.

\subsection{Spatial prediction}\label{s:pred}
Given $\bY_t$ the usual Kriging equations give the predictive distribution for $Y_t(\bs^*)$ at prediction location $(\bs^*)$


\section{Data analysis}\label{s:analysis}


\section{Conclusions}\label{s:con}

\section*{Acknowledgments}

\section*{Appendix A.1: Posterior distributions}
\input{zpost.tex}
\input{betapost.tex}
\input{sigpost.tex}

\section*{Appendix A.2: MCMC Details}

\subsection*{Priors}



\bibliographystyle{rss}
\bibliography{skewnormal}

\end{document}

